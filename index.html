<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no,viewport-fit=cover"><meta name="theme-color" content="#2d2d2d"><title>BUBBLE SHOOTER</title><style>*{margin:0;padding:0;box-sizing:border-box}body{width:100vw;height:100vh;overflow:hidden;background:linear-gradient(180deg,#FF1744,#F50057,#D500F9,#651FFF,#2979FF,#00E5FF,#00E676,#76FF03,#FFEA00,#FFC400,#FF6D00,#DD2C00);font-family:Arial,sans-serif;touch-action:none;position:fixed;top:0;left:0}#gameWrap{width:100%;height:100%;position:relative;display:flex;flex-direction:column;background:inherit}#topBar{position:absolute;top:10px;left:10px;display:flex;flex-direction:column;gap:10px;z-index:1000;background:rgba(0,0,0,0.85);padding:10px 15px;border-radius:30px;box-shadow:0 4px 20px rgba(0,0,0,0.6)}.score-box{display:flex;flex-direction:column;align-items:center;color:#fff;text-shadow:1px 1px 3px #000}.score-lbl{font-size:10px;opacity:0.85;letter-spacing:0.5px;font-weight:bold;color:#FFD700}.score-val{font-size:20px;font-weight:bold;color:#00FF00}#cvs{display:block;width:100%;height:100%;touch-action:none}#modal{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:linear-gradient(135deg,#1a237e,#311b92);padding:30px;border-radius:20px;text-align:center;display:none;z-index:2000;min-width:240px;box-shadow:0 8px 30px rgba(0,0,0,0.7)}#modal h1{color:#FFD700;font-size:38px;margin-bottom:12px;text-shadow:0 0 20px rgba(255,215,0,0.8)}#modal p{color:#fff;font-size:16px;margin:8px 0}#btn{background:linear-gradient(135deg,#ff1744,#f50057);color:#fff;border:none;padding:12px 35px;font-size:16px;border-radius:30px;cursor:pointer;margin-top:15px;box-shadow:0 4px 15px rgba(245,0,87,0.6);transition:transform 0.2s}#btn:hover{transform:scale(1.05)}</style></head><body><div id="gameWrap"><div id="topBar"><div class="score-box"><div class="score-lbl">ОЧКИ</div><div class="score-val" id="sc">0</div></div><div class="score-box"><div class="score-lbl">ХОДЫ</div><div class="score-val" id="mv">30</div></div></div><canvas id="cvs"></canvas><div id="modal"><h1>GAME OVER!</h1><p>Очки: <span id="fs">0</span></p><p>Рекорд: <span id="bs">0</span></p><button id="btn">Новая игра</button></div></div><script src="https://telegram.org/js/telegram-web-app.js"></script><script>let tg=window.Telegram?.WebApp;if(tg){tg.ready();tg.expand();}const c=document.getElementById('cvs'),ctx=c.getContext('2d'),scD=document.getElementById('sc'),mvD=document.getElementById('mv'),mod=document.getElementById('modal'),fsD=document.getElementById('fs'),bsD=document.getElementById('bs'),btn=document.getElementById('btn');let W,H,R,rows=5,cols=11,balls=[],popAnimations=[],shooter={x:0,y:0,color:null},sc=0,mv=30,bs=localStorage.getItem('bs')||0,colors=['#FF0000','#00FF00','#0000FF','#FFFF00','#FF00FF','#00FFFF','#FF6600','#FF0099'],animating=false;function resize(){W=c.width=window.innerWidth;H=c.height=window.innerHeight;R=Math.min(W,H)/24;shooter.y=H-R*2.8;}function getPos(r,c){let offset=r%2?0.5:0;return{x:(c+0.5+offset)*R*2+W/2-cols*R-R,y:r*R*1.8+R*2};}function init(){resize();balls=[];popAnimations=[];for(let r=0;r<rows;r++){for(let c=0;c<cols;c++){let pos=getPos(r,c);balls.push({r,c,x:pos.x,y:pos.y,color:colors[Math.floor(Math.random()*colors.length)]});}}shooter.color=colors[Math.floor(Math.random()*colors.length)];shooter.x=W/2;sc=0;mv=30;scD.textContent=sc;mvD.textContent=mv;mod.style.display='none';animate();}function animate(){requestAnimationFrame(animate);draw();}function draw(){ctx.clearRect(0,0,W,H);balls.forEach(b=>{ctx.fillStyle=b.color;ctx.beginPath();ctx.arc(b.x,b.y,R,0,Math.PI*2);ctx.fill();ctx.strokeStyle='#FFF';ctx.lineWidth=3;ctx.stroke();});popAnimations.forEach((p,i)=>{let progress=p.time/p.duration;if(progress>=1){popAnimations.splice(i,1);return;}let scale=1+progress*0.4;let alpha=1-progress;ctx.save();ctx.globalAlpha=alpha;ctx.fillStyle=p.color;ctx.beginPath();ctx.arc(p.x,p.y,R*scale,0,Math.PI*2);ctx.fill();ctx.restore();p.time+=16;});ctx.fillStyle=shooter.color;ctx.beginPath();ctx.arc(shooter.x,shooter.y,R*1.3,0,Math.PI*2);ctx.fill();ctx.strokeStyle='#FFF';ctx.lineWidth=4;ctx.stroke();}function getNearby(idx){let ball=balls[idx];let nearby=[];for(let i=0;i<balls.length;i++){if(i===idx)continue;let d=Math.sqrt((balls[i].x-ball.x)**2+(balls[i].y-ball.y)**2);if(d<R*2.5&&balls[i].color===ball.color){nearby.push(i);}}return nearby;}function getConnected(idx){let visited=new Set(),toVisit=[idx],group=[];while(toVisit.length){let i=toVisit.pop();if(visited.has(i))continue;visited.add(i);group.push(i);getNearby(i).forEach(n=>{if(!visited.has(n))toVisit.push(n);});}return group;}function shoot(tx,ty){if(animating||mv<=0)return;animating=true;let dx=tx-shooter.x,dy=ty-shooter.y,dist=Math.sqrt(dx*dx+dy*dy);if(dist===0)return;let vx=dx/dist*10,vy=dy/dist*10,bx=shooter.x,by=shooter.y,bc=shooter.color;let interval=setInterval(()=>{bx+=vx;by+=vy;if(bx<R||bx>W-R)vx=-vx;let hit=-1;for(let i=0;i<balls.length;i++){let d=Math.sqrt((bx-balls[i].x)**2+(by-balls[i].y)**2);if(d<R*1.9){hit=i;break;}}if(hit>=0){clearInterval(interval);let targetRow=Math.round(by/(R*1.8));if(targetRow<0)targetRow=0;if(targetRow>=rows)targetRow=rows-1;let targetOffset=targetRow%2?0.5:0;let bestCol=-1,bestDist=999;for(let c=0;c<cols;c++){let x=(c+0.5+targetOffset)*R*2+W/2-cols*R-R;let d=Math.abs(x-bx);if(d<bestDist&&!balls.find(b=>b.r===targetRow&&b.c===c)){bestDist=d;bestCol=c;}}if(bestCol>=0){balls.push({r:targetRow,c:bestCol,x:(bestCol+0.5+targetOffset)*R*2+W/2-cols*R-R,y:targetRow*R*1.8+R*2,color:bc});let lastIdx=balls.length-1;let group=getConnected(lastIdx);if(group.length>=3){let removeIndices=[...group].sort((a,b)=>b-a);removeIndices.forEach(i=>{let b=balls[i];popAnimations.push({x:b.x,y:b.y,color:b.color,time:0,duration:400});balls.splice(i,1);});sc+=group.length*10;scD.textContent=sc;}}mv--;mvD.textContent=mv;shooter.color=colors[Math.floor(Math.random()*colors.length)];animating=false;if(mv<=0)gameOver();return;}if(by<0){clearInterval(interval);animating=false;}},30);}function gameOver(){if(sc>bs){bs=sc;localStorage.setItem('bs',bs);}fsD.textContent=sc;bsD.textContent=bs;mod.style.display='block';}btn.onclick=()=>{init();};c.onclick=e=>shoot(e.clientX,e.clientY);c.ontouchstart=e=>{e.preventDefault();let touch=e.touches[0];shoot(touch.clientX,touch.clientY);};window.onresize=()=>{resize();draw();};init();</script></body></html>
