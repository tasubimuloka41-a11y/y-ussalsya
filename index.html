<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>üéÆ BUBBLE SHOOTER</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{width:100vw;height:100vh;overflow:hidden;background:linear-gradient(45deg,#FF1744,#F50057,#D500F9,#651FFF,#2979FF,#00B0FF,#1DE9B6,#00E676,#76FF03,#FFEA00,#FF9100);background-size:400% 400%;animation:bg 20s ease infinite;font-family:Arial;touch-action:none;-webkit-tap-highlight-color:transparent}
@keyframes bg{0%,100%{background-position:0% 50%}50%{background-position:100% 50%}}
#game{width:100%;height:100%;position:relative}
#topBar{position:absolute;top:5px;left:5px;display:flex;gap:8px;background:rgba(0,0,0,0.6);padding:5px 10px;border-radius:20px;z-index:10}
.sb{display:flex;flex-direction:column;align-items:center;color:#fff}
.sl{font-size:7px;opacity:0.9;letter-spacing:0.5px;color:#FFD700}
.sv{font-size:16px;font-weight:bold;color:#0F0}
#cvs{display:block;width:100%;height:100%;touch-action:none}
#next{position:absolute;bottom:10px;right:10px;display:flex;flex-direction:column;align-items:center;background:rgba(0,0,0,0.6);padding:8px;border-radius:15px;z-index:10}
#next span{color:#FFD700;font-size:8px;margin-bottom:3px;font-weight:bold}
#next canvas{display:block}
#modal{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:linear-gradient(135deg,#1a237e,#311b92);padding:25px;border-radius:15px;text-align:center;display:none;z-index:100;min-width:200px;box-shadow:0 8px 30px rgba(0,0,0,0.7)}
#modal h1{color:#FFD700;font-size:32px;margin-bottom:10px;text-shadow:0 0 20px rgba(255,215,0,0.9)}
#modal p{color:#fff;font-size:14px;margin:8px 0}
#btn{background:linear-gradient(135deg,#FF1744,#F50057);color:#fff;border:none;padding:12px 30px;font-size:16px;border-radius:30px;cursor:pointer;margin-top:15px;box-shadow:0 4px 15px rgba(245,0,87,0.7)}
@media(max-width:600px){#topBar{top:3px;left:3px;gap:6px;padding:4px 8px}.sl{font-size:6px}.sv{font-size:14px}#next{bottom:8px;right:8px;padding:6px}#next span{font-size:7px}#modal{padding:20px;min-width:180px}#modal h1{font-size:28px}#modal p{font-size:12px}#btn{padding:10px 25px;font-size:14px}}
</style>
</head>
<body>
<div id="game">
<div id="topBar">
<div class="sb"><div class="sl">–û–ß–ö–ò</div><div class="sv" id="sc">0</div></div>
<div class="sb"><div class="sl">–•–û–î–´</div><div class="sv" id="mv">30</div></div>
</div>
<canvas id="cvs"></canvas>
<div id="next"><span>–°–õ–ï–î</span><canvas id="nxt" width="40" height="40"></canvas></div>
<div id="modal">
<h1>GAME OVER</h1>
<p>–û—á–∫–∏: <span id="fs">0</span></p>
<p>–†–µ–∫–æ—Ä–¥: <span id="bs">0</span></p>
<button id="btn">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
</div>
</div>
<script>const c=document.getElementById('cvs'),ctx=c.getContext('2d'),scD=document.getElementById('sc'),mvD=document.getElementById('mv'),mod=document.getElementById('modal'),fsD=document.getElementById('fs'),bsD=document.getElementById('bs'),btn=document.getElementById('btn'),nxt=document.getElementById('nxt'),nxtCtx=nxt.getContext('2d');
let W,H,R,rows=6,cols=12,grid=[],shooter={x:0,y:0,c:null,nextC:null},sc=0,mv=30,bs=localStorage.getItem('bs')||0,emojis=['üòÄ','üòÅ','üòÇ','üòÉ','üòÑ','üòä','ü§£','üòé'],colors=['#FF3333','#3399FF','#33FF33','#FFFF00','#FF00FF','#FF9900','#00FFFF','#FF0099'],particles=[],animating=false;
function resize(){W=c.width=window.innerWidth;H=c.height=window.innerHeight;R=Math.min(W,H)/28;shooter.y=H-R*3;}
function init(){resize();grid=[];particles=[];for(let r=0;r<rows;r++){grid[r]=[];for(let c=0;c<cols;c++){let x=(c+0.5+(r%2?0.5:0))*R*2+W/2-cols*R;let y=r*R*1.7+R*2;if(x>R&&x<W-R)grid[r].push({x:x,y:y,c:colors[Math.floor(Math.random()*colors.length)],e:emojis[Math.floor(Math.random()*emojis.length)],scale:1,alpha:1,falling:false,vy:0});}}shooter.c=colors[Math.floor(Math.random()*colors.length)];shooter.nextC=colors[Math.floor(Math.random()*colors.length)];shooter.x=W/2;sc=0;mv=30;scD.textContent=sc;mvD.textContent=mv;mod.style.display='none';drawNext();}
function drawNext(){nxtCtx.clearRect(0,0,40,40);nxtCtx.fillStyle=shooter.nextC;nxtCtx.beginPath();nxtCtx.arc(20,20,15,0,Math.PI*2);nxtCtx.fill();nxtCtx.strokeStyle='#FFF';nxtCtx.lineWidth=2;nxtCtx.stroke();}
function draw(){ctx.clearRect(0,0,W,H);grid.forEach(row=>row.forEach(b=>{if(b&&b.alpha>0){ctx.save();ctx.globalAlpha=b.alpha;ctx.fillStyle=b.c;ctx.beginPath();ctx.arc(b.x,b.y,R*b.scale,0,Math.PI*2);ctx.fill();ctx.strokeStyle='#FFF';ctx.lineWidth=2;ctx.stroke();ctx.font=(R*1.2*b.scale)+'px Arial';ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText(b.e,b.x,b.y);ctx.restore();}}));particles.forEach(p=>{if(p.alpha>0){ctx.save();ctx.globalAlpha=p.alpha;ctx.fillStyle=p.c;ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,Math.PI*2);ctx.fill();ctx.restore();}});ctx.fillStyle=shooter.c;ctx.beginPath();ctx.arc(shooter.x,shooter.y,R,0,Math.PI*2);ctx.fill();ctx.strokeStyle='#FFF';ctx.lineWidth=2;ctx.stroke();}
function createParticles(x,y,col,count=10){for(let i=0;i<count;i++){let angle=Math.random()*Math.PI*2;let speed=2+Math.random()*3;particles.push({x:x,y:y,vx:Math.cos(angle)*speed,vy:Math.sin(angle)*speed,r:R*0.12,c:col,alpha:1,life:25});}}
function updateParticles(){particles=particles.filter(p=>{p.x+=p.vx;p.y+=p.vy;p.vy+=0.2;p.alpha-=0.04;p.life--;return p.life>0&&p.alpha>0;});}
function getNeighbors(r,c){let n=[],offsets=r%2?[[0,-1],[0,1],[-1,0],[-1,1],[1,0],[1,1]]:[[0,-1],[0,1],[-1,-1],[-1,0],[1,-1],[1,0]];offsets.forEach(([dr,dc])=>{let nr=r+dr,nc=c+dc;if(nr>=0&&nr<grid.length&&nc>=0&&nc<grid[nr].length&&grid[nr][nc]&&grid[nr][nc].alpha>0)n.push({r:nr,c:nc});});return n;}
function findMatches(r,c){if(!grid[r]||!grid[r][c])return[];let clr=grid[r][c].c,visited=new Set(),toVisit=[{r:r,c:c}],matches=[];while(toVisit.length){let{r:cr,c:cc}=toVisit.pop(),key=cr+','+cc;if(visited.has(key))continue;visited.add(key);matches.push({r:cr,c:cc});getNeighbors(cr,cc).forEach(({r:nr,c:nc})=>{if(grid[nr][nc].c===clr&&!visited.has(nr+','+nc))toVisit.push({r:nr,c:nc});});}return matches;}
function findFloatingClusters(){let connected=new Set();function dfs(r,c){let key=r+','+c;if(connected.has(key)||!grid[r]||!grid[r][c]||grid[r][c].alpha<=0)return;connected.add(key);getNeighbors(r,c).forEach(({r:nr,c:nc})=>dfs(nr,nc));}for(let c=0;c<grid[0].length;c++){if(grid[0][c]&&grid[0][c].alpha>0)dfs(0,c);}let floating=[];grid.forEach((row,r)=>row.forEach((b,c)=>{if(b&&b.alpha>0&&!connected.has(r+','+c)){b.falling=true;b.vy=0;floating.push(b);}}));return floating.length>0;}
function applyGravity(){let moved=false;grid.forEach(row=>row.forEach(b=>{if(b&&b.falling){b.vy+=0.5;b.y+=b.vy;if(b.y>H){b.alpha=0;}moved=true;}}));return moved;}
function animateExplosion(matches){matches.forEach(({r,c})=>{let b=grid[r][c];if(b){createParticles(b.x,b.y,b.c,12);b.exploding=true;}});let frame=0;let explodeAnim=setInterval(()=>{frame++;matches.forEach(({r,c})=>{let b=grid[r][c];if(b&&b.exploding){b.scale=1+frame*0.08;b.alpha=Math.max(0,1-frame*0.15);}});draw();updateParticles();if(frame>=10){matches.forEach(({r,c})=>grid[r][c]=null);findFloatingClusters();clearInterval(explodeAnim);animating=false;if(mv<=0){gameOver();}}},30);}
function shoot(tx,ty){if(animating||mv<=0)return;animating=true;let dx=tx-shooter.x,dy=ty-shooter.y,dist=Math.sqrt(dx*dx+dy*dy),vx=dx/dist*12,vy=dy/dist*12,bx=shooter.x,by=shooter.y,bc=shooter.c;let interval=setInterval(()=>{bx+=vx;by+=vy;if(bx<R||bx>W-R)vx=-vx;draw();ctx.fillStyle=bc;ctx.beginPath();ctx.arc(bx,by,R,0,Math.PI*2);ctx.fill();ctx.strokeStyle='#FFF';ctx.lineWidth=2;ctx.stroke();let placed=false;grid.forEach((row,r)=>{row.forEach((b,c)=>{if(b&&b.alpha>0&&!placed){let d=Math.sqrt((bx-b.x)**2+(by-b.y)**2);if(d<R*2){clearInterval(interval);let newR=r,newC=c;if(by<b.y-R){newR=Math.max(0,r-1);let offsetX=(newR%2?0.5:0)*R*2;newC=Math.round((bx-W/2+cols*R-offsetX)/(R*2)-0.5);}else{let angle=Math.atan2(by-b.y,bx-b.x),offsets=r%2?[[0,-1],[0,1],[-1,0],[-1,1],[1,0],[1,1]]:[[0,-1],[0,1],[-1,-1],[-1,0],[1,-1],[1,0]],best=null,minDiff=999;offsets.forEach(([dr,dc])=>{let nr=r+dr,nc=c+dc;if(nr>=0&&nc>=0&&nc<cols){let x=(nc+0.5+(nr%2?0.5:0))*R*2+W/2-cols*R,y=nr*R*1.7+R*2,a=Math.atan2(y-b.y,x-b.x),diff=Math.abs(a-angle);if(diff<minDiff&&(!grid[nr]||!grid[nr][nc]||grid[nr][nc].alpha<=0)){minDiff=diff;best={r:nr,c:nc,x:x,y:y};}}});if(best){newR=best.r;newC=best.c;}}if(!grid[newR])grid[newR]=[];grid[newR][newC]={x:(newC+0.5+(newR%2?0.5:0))*R*2+W/2-cols*R,y:newR*R*1.7+R*2,c:bc,e:emojis[Math.floor(Math.random()*emojis.length)],scale:1,alpha:1,falling:false,vy:0};let matches=findMatches(newR,newC);if(matches.length>=3){animateExplosion(matches);sc+=matches.length*10;scD.textContent=sc;}else{animating=false;}mv--;mvD.textContent=mv;shooter.c=shooter.nextC;shooter.nextC=colors[Math.floor(Math.random()*colors.length)];drawNext();if(mv<=0&&!animating){gameOver();}placed=true;}}})});if(by<R){clearInterval(interval);animating=false;draw();}},20);}
function gameLoop(){if(applyGravity()||particles.length>0){updateParticles();draw();requestAnimationFrame(gameLoop);}}
function gameOver(){if(sc>bs){bs=sc;localStorage.setItem('bs',bs);}fsD.textContent=sc;bsD.textContent=bs;mod.style.display='block';}
btn.onclick=()=>{init();draw();};
c.onclick=e=>shoot(e.clientX,e.clientY);
c.ontouchstart=e=>{e.preventDefault();shoot(e.touches[0].clientX,e.touches[0].clientY);};
window.onresize=()=>{resize();draw();};
init();draw();requestAnimationFrame(gameLoop);
</script>
</body>
</html>
